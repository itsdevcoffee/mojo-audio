[workspace]
authors = ["itsdevcoffee <itstexmex@gmail.com>"]
channels = ["https://conda.modular.com/max-nightly", "conda-forge"]
name = "mojo-audio"
platforms = ["linux-64", "osx-arm64", "linux-aarch64"]
version = "0.2.0"
description = "High-performance audio DSP library in Mojo - beats Python!"

[tasks]
# Testing
test-window = "mojo -I src tests/test_window.mojo"
test-fft = "mojo -I src tests/test_fft.mojo"
test-mel = "mojo -I src tests/test_mel.mojo"
test = "mojo -I src tests/test_window.mojo && mojo -I src tests/test_fft.mojo && mojo -I src tests/test_mel.mojo"

# Examples
demo-window = "mojo -I src examples/window_demo.mojo"
demo-fft = "mojo -I src examples/fft_demo.mojo"
demo-mel = "mojo -I src examples/mel_demo.mojo"
demo = "mojo -I src examples/mel_demo.mojo"

# Benchmarks
bench = "mojo -I src benchmarks/bench_mel_spectrogram.mojo"
bench-optimized = "mojo -O3 -I src benchmarks/bench_mel_spectrogram.mojo"
bench-python = "python benchmarks/compare_librosa.py"

# Development
repl = "mojo"

# UI
ui = "cd ui/backend && python app.py"

# FFI - Build shared library for C/Rust/Python integration
build-ffi = "mojo build --emit shared-lib -I src -o libmojo_audio.so src/ffi/audio_ffi.mojo"
build-ffi-optimized = "mojo build --emit shared-lib -O3 -I src -o libmojo_audio.so src/ffi/audio_ffi.mojo"
install-ffi = """
    mkdir -p $HOME/.local/lib &&
    cp libmojo_audio.so $HOME/.local/lib/ &&
    mkdir -p $HOME/.local/include &&
    cp include/mojo_audio.h $HOME/.local/include/ &&
    echo 'FFI library installed to ~/.local/lib and ~/.local/include'
"""
clean-ffi = "rm -f libmojo_audio.so libmojo_audio.dylib"

# Platform-specific FFI builds
[target.osx.tasks]
build-ffi = "mojo build --emit shared-lib -I src -o libmojo_audio.dylib src/ffi/audio_ffi.mojo"
build-ffi-optimized = "mojo build --emit shared-lib -O3 -I src -o libmojo_audio.dylib src/ffi/audio_ffi.mojo"
install-ffi = """
    mkdir -p $HOME/.local/lib &&
    cp libmojo_audio.dylib $HOME/.local/lib/ &&
    mkdir -p $HOME/.local/include &&
    cp include/mojo_audio.h $HOME/.local/include/ &&
    echo 'FFI library installed to ~/.local/lib and ~/.local/include'
"""

[dependencies]
max = "==26.1.0.dev2026010718"
mojo = "==0.26.1.0.dev2026010718"
matplotlib = ">=3.10.8,<4"
scipy = ">=1.16.3,<2"
librosa = ">=0.11.0,<0.12"
numba = ">=0.63.1,<0.64"
fastapi = ">=0.115.3"
uvicorn = ">=0.27.0"
pydantic = ">=2.5.3"
python-multipart = ">=0.0.6"

# BLAS backend features - allows switching between MKL and OpenBLAS
# Note: MKL is Linux-only, macOS uses OpenBLAS automatically
[feature.mkl.target.linux-64.dependencies]
libblas = { version = "*", build = "*mkl" }

[feature.openblas.dependencies]
libblas = { version = "*", build = "*openblas" }

[environments]
default = { features = ["openblas"], solve-group = "default" }
mkl = { features = ["mkl"], solve-group = "mkl" }
openblas = { features = ["openblas"], solve-group = "default" }
