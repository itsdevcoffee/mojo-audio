<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mojo-audio | Building a Fast Mel Spectrogram Library in Mojo</title>
    <link rel="stylesheet" href="../static/css/style.css?v=3">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Ambient background orbs -->
    <div class="bg-orb bg-orb-1"></div>
    <div class="bg-orb bg-orb-2"></div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1 class="title">
                <span class="emoji">üéµ</span>
                <span class="gradient-text">mojo-audio</span>
            </h1>
            <p class="subtitle">Whisper Mel Spectrogram Benchmark</p>
            <p class="tagline">High-performance audio DSP in Mojo that beats Python</p>
        </header>

        <!-- COMPACT HORIZONTAL CONFIG -->
        <div class="glass-card config-card">
            <div class="config-header" onclick="toggleConfig()">
                <span class="config-title">Configuration</span>
                <button class="collapse-btn" id="collapseBtn">‚àí</button>
            </div>

            <div class="config-content" id="configContent">
                <!-- Duration -->
                <div class="config-group">
                    <label class="config-label">Duration</label>
                    <div class="toggle-group">
                        <button class="toggle-btn" onclick="selectDuration(1, this)">1s</button>
                        <button class="toggle-btn" onclick="selectDuration(10, this)">10s</button>
                        <button class="toggle-btn active" onclick="selectDuration(30, this)" id="duration30">30s</button>
                    </div>
                </div>

                <div class="divider"></div>

                <!-- FFT Size -->
                <div class="config-group">
                    <label class="config-label">FFT Size</label>
                    <div class="toggle-group">
                        <button class="toggle-btn" onclick="selectFFT(256, this)">256</button>
                        <button class="toggle-btn active" onclick="selectFFT(400, this)" id="fft400">400</button>
                        <button class="toggle-btn" onclick="selectFFT(512, this)">512</button>
                        <button class="toggle-btn" onclick="selectFFT(1024, this)">1024</button>
                    </div>
                </div>

                <div class="divider"></div>

                <!-- Runs -->
                <div class="config-group">
                    <label class="config-label">Runs</label>
                    <div class="number-input">
                        <button class="number-btn" onclick="decrementRuns()">‚àí</button>
                        <input type="number" id="runs" value="20" min="1" max="100" readonly>
                        <button class="number-btn" onclick="incrementRuns()">+</button>
                    </div>
                </div>

                <div class="divider"></div>

                <!-- Machine Selection -->
                <div class="config-group">
                    <label class="config-label">Machine</label>
                    <select id="machineSelect" class="machine-select" onchange="selectMachine(this.value)">
                        <option value="intel-i7-1360p">Intel i7-1360P (x86, AVX2)</option>
                        <option value="nvidia-dgx-spark">NVIDIA DGX Spark (ARM, NEON)</option>
                    </select>
                </div>

                <!-- BLAS Backend -->
                <div class="config-group">
                    <label class="config-label">BLAS</label>
                    <div class="toggle-group">
                        <button class="toggle-btn active" onclick="selectBLAS('mkl', this)" id="blasMKL">MKL</button>
                        <button class="toggle-btn" onclick="selectBLAS('openblas', this)" id="blasOpenBLAS">OpenBLAS</button>
                    </div>
                </div>

                <button class="primary-button" onclick="runBenchmark()" id="runBtn">
                    <span>>_</span>
                    <span>Run Benchmark</span>
                </button>
            </div>
        </div>

        <!-- HERO RESULT (shows first, most prominent!) -->
        <div class="hero-result" id="heroResult" style="display: none;">
            <div class="hero-content">
                <span class="hero-emoji">üî•</span>
                <span class="hero-number" id="heroNumber">--</span>
                <span class="hero-text">faster than librosa</span>
                <span class="hero-badge">mojo-audio wins</span>
            </div>
        </div>

        <!-- COMPARISON with VS divider -->
        <div class="comparison-grid" id="comparisonGrid" style="display: none;">
            <!-- librosa -->
            <div class="result-card" id="librosaCard">
                <div class="result-header">
                    <div class="result-title-group">
                        <span class="result-icon">üêç</span>
                        <div>
                            <div class="result-name">librosa</div>
                            <div class="result-lang">Python</div>
                        </div>
                    </div>
                    <span class="winner-badge" id="librosaBadge" style="display: none;">‚ö° FASTER</span>
                </div>
                <div class="result-time" id="librosaTime">--</div>
                <div class="result-throughput" id="librosaThroughput">--</div>
                <div class="result-bar">
                    <div class="bar-fill bar-librosa" id="librosaBar"></div>
                </div>
            </div>

            <!-- VS divider -->
            <div class="vs-divider">
                <div class="vs-circle">vs</div>
            </div>

            <!-- mojo-audio -->
            <div class="result-card delay-1" id="mojoCard">
                <div class="result-header">
                    <div class="result-title-group">
                        <span class="result-icon">üî•</span>
                        <div>
                            <div class="result-name">mojo-audio</div>
                            <div class="result-lang">Mojo</div>
                        </div>
                    </div>
                    <span class="winner-badge" id="mojoBadge" style="display: none;">‚ö° FASTER</span>
                </div>
                <div class="result-time" id="mojoTime">--</div>
                <div class="result-throughput" id="mojoThroughput">--</div>
                <div class="result-bar">
                    <div class="bar-fill bar-mojo" id="mojoBar"></div>
                </div>
            </div>
        </div>

        <!-- STATS ROW -->
        <div class="stats-row" id="statsRow" style="display: none;">
            <div class="stat-card">
                <div class="stat-value" id="speedupFactor">--</div>
                <div class="stat-label">Speedup Factor</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="framesProcessed">--</div>
                <div class="stat-label">Frames Processed</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="runsAveraged">--</div>
                <div class="stat-label">Runs Averaged</div>
            </div>
        </div>

        <!-- OPTIMIZATION CHART (bigger!) -->
        <div class="glass-card chart-card" id="chartCard" style="display: none;">
            <h3 class="chart-title">Optimization Journey</h3>
            <p class="chart-subtitle">From 476ms to 25ms ‚Äî a 19√ó speedup with split-radix FFT</p>
            <canvas id="optimizationChart"></canvas>
        </div>

        <!-- Actions -->
        <div class="actions" id="actions" style="display: none;">
            <button class="secondary-button" onclick="downloadResults()">
                <span>üì•</span> Download Results
            </button>
            <a href="https://github.com/itsdevcoffee/mojo-audio" target="_blank" class="secondary-button">
                <span>‚≠ê</span> View on GitHub
            </a>
        </div>

        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loadingOverlay" style="display: none;">
            <div class="loading-card">
                <div class="spinner"></div>
                <div class="loading-text">Running benchmarks...</div>
                <div class="loading-subtext">This may take 30-60 seconds</div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <span id="modeStatus" class="mode-status">‚Ä¢ MODE: LOADING</span>
            <span>‚Ä¢ FFT_ENGINE: SPLIT_RADIX</span>
        </div>
    </div>

    <!-- Demo Mode Info Modal -->
    <div class="modal-overlay" id="demoModal" style="display: none;" onclick="closeDemoModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">
                    <span class="modal-icon">üéÆ</span>
                    <h2>Demo Mode</h2>
                </div>
                <button class="modal-close" onclick="closeDemoModal()">&times;</button>
            </div>

            <div class="modal-body">
                <section class="modal-section">
                    <h3>What is Demo Mode?</h3>
                    <p>
                        This benchmark UI runs in <strong>demo mode</strong> using pre-computed results.
                        All 24 configuration combinations were benchmarked on real hardware and the results
                        are served statically for instant access.
                    </p>
                    <div class="info-box">
                        <div class="info-item">
                            <span class="info-label">Configs Generated:</span>
                            <span class="info-value">24 (3 durations √ó 4 FFT sizes √ó 2 BLAS)</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Base Iterations:</span>
                            <span class="info-value">20 runs per config</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Smart Features:</span>
                            <span class="info-value">Interpolation + realistic variance</span>
                        </div>
                    </div>
                </section>

                <section class="modal-section">
                    <h3>üíª Benchmark Hardware</h3>
                    <div class="hw-compact">
                        <div class="hw-row">
                            <span class="hw-icon">üñ•Ô∏è</span>
                            <span class="hw-label">CPU</span>
                            <span class="hw-value">Intel i7-1360P (12C/16T)</span>
                        </div>
                        <div class="hw-row">
                            <span class="hw-icon">üéÆ</span>
                            <span class="hw-label">GPU</span>
                            <span class="hw-value">RTX 4060 Ti + Intel Iris Xe</span>
                        </div>
                        <div class="hw-row">
                            <span class="hw-icon">üêß</span>
                            <span class="hw-label">OS</span>
                            <span class="hw-value">Fedora 43 (Kernel 6.18.4)</span>
                        </div>
                        <div class="hw-row">
                            <span class="hw-icon">üî•</span>
                            <span class="hw-label">Mojo</span>
                            <span class="hw-value">0.26.2.0.dev2026020405</span>
                        </div>
                    </div>
                </section>

                <section class="modal-section">
                    <h3>How It Works</h3>
                    <ul class="feature-list">
                        <li>
                            <span class="feature-icon">üìä</span>
                            <div>
                                <strong>Pre-computed Base Data:</strong>
                                Real benchmarks for all 24 configs (20 iterations each)
                            </div>
                        </li>
                        <li>
                            <span class="feature-icon">üßÆ</span>
                            <div>
                                <strong>Smart Interpolation:</strong>
                                Run count (1-100) mathematically interpolated from base data
                            </div>
                        </li>
                        <li>
                            <span class="feature-icon">üé≤</span>
                            <div>
                                <strong>Realistic Variance:</strong>
                                ¬±3-5% randomness simulates real benchmark behavior
                            </div>
                        </li>
                        <li>
                            <span class="feature-icon">‚è±Ô∏è</span>
                            <div>
                                <strong>Dynamic Loading:</strong>
                                Loading time scales with config complexity (1.5-8s)
                            </div>
                        </li>
                    </ul>
                </section>

                <section class="modal-section modal-cta">
                    <h3>Want to Run Live Benchmarks?</h3>
                    <p>
                        Clone the repository and run benchmarks on your own hardware to see
                        how mojo-audio performs on your system.
                    </p>
                    <div class="cta-buttons">
                        <a href="https://github.com/itsdevcoffee/mojo-audio#building-from-source"
                           target="_blank"
                           class="cta-button primary">
                            üì• Build from Source
                        </a>
                        <a href="https://github.com/itsdevcoffee/mojo-audio/releases"
                           target="_blank"
                           class="cta-button secondary">
                            ‚¨áÔ∏è Download Release
                        </a>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Benchmark System: Config ‚Üí Demo ‚Üí API ‚Üí Main -->
    <script src="../static/js/config.js"></script>
    <script src="../static/js/demo-mode.js"></script>
    <script src="../static/js/benchmark-api.js"></script>
    <script src="../static/js/main.js"></script>

    <!-- Initialize benchmark system -->
    <script>
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                const mode = await window.BenchmarkAPI.init();
                console.log('‚úÖ Benchmark UI initialized in', mode, 'mode');

                // Update status bar with mode
                updateStatusBar(mode);

                // Make mode clickable if in demo mode
                if (mode === 'demo') {
                    enableDemoModeClick();
                }
            } catch (error) {
                console.error('‚ùå Initialization failed:', error);
                alert('Failed to initialize benchmark UI. Please refresh the page.');
            }
        });

        // Update status bar with mode
        function updateStatusBar(mode) {
            const modeStatus = document.getElementById('modeStatus');
            const modeText = mode === 'demo' ? 'DEMO' : 'LIVE';
            modeStatus.textContent = `‚Ä¢ MODE: ${modeText}`;
        }

        // Enable demo mode click handler
        function enableDemoModeClick() {
            const modeStatus = document.getElementById('modeStatus');
            modeStatus.classList.add('clickable');
            modeStatus.onclick = openDemoModal;
        }

        // Open demo info modal
        function openDemoModal() {
            document.getElementById('demoModal').style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Prevent background scroll
        }

        // Close demo info modal
        function closeDemoModal(event) {
            // Only close if clicking overlay or close button
            if (!event || event.target.id === 'demoModal' || event.target.className === 'modal-close') {
                document.getElementById('demoModal').style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }

        // Keyboard shortcut: ESC to close modal
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeDemoModal();
            }
        });
    </script>
</body>
</html>
